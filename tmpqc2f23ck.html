
        <!DOCTYPE html>
        <html>
        <head>
            <title>Местоположение вышек</title>
            <meta charset="utf-8">
            <meta name="viewport" content="width=device-width, initial-scale=1.0">
            <script src="https://api-maps.yandex.ru/2.1/?lang=ru_RU" type="text/javascript"></script>
            <style>
                #mapYandex {
                    width: 100%;
                    height: 90vh;
                }
                #controls {
                    text-align: center;
                    padding: 10px;
                    box-sizing: border-box;
                }
                @media (max-width: 768px) {
                    #mapYandex {
                        height: 70vh;
                    }
                }
                @media (max-width: 480px) {
                    #mapYandex {
                        height: 60vh;
                    }
                }
            </style>
        </head>
        <body>
            <div id="controls">
                <button onclick="toggleService('Yandex')">Скрыть Yandex</button>
                <button onclick="toggleService('Mylnikov')">Скрыть Mylnikov</button>
                <input type="text" id="imeiSearch" placeholder="Введите IMEI для поиска">
                <button onclick="searchByIMEI()">Найти IMEI</button>
            </div>
            <div id="mapYandex"></div>
            <script type="text/javascript">
                var myMap;
                var placemarks = [];
                var circles = [];
                var circleVisible = [];
                var yandexVisible = true;
                var mylnikovVisible = true;

                ymaps.ready(initYandex);
                function initYandex() {
                    myMap = new ymaps.Map("mapYandex", {
                        center: [55.751244, 37.618423],
                        zoom: 10
                    });
                    
        var placemark0 = new ymaps.Placemark([59.92511367797852, 30.34511566162109], {
            balloonContent: 'IMEI: 866011051426039<br>Координаты: 59.92511367797852, 30.34511566162109<br>Радиус: 249.998291015625 м<br>Сервис: Yandex<br><a href="https://yandex.ru/maps/?ll=30.34511566162109%2C59.92511367797852&z=15&l=map&pt=30.34511566162109,59.92511367797852,pm2dgl" target="_blank">Посмотреть на Яндекс.Картах</a><br><button onclick="toggleCircleVisibility(0)">Показать радиус</button><br><button onclick="copyCoordinates(59.92511367797852, 30.34511566162109)">Копировать координаты</button><br><button onclick="removeTower(0)">Удалить вышку</button>' 
        }, {
            preset: 'islands#redIcon'
        });
        var circle0 = new ymaps.Circle([[59.92511367797852, 30.34511566162109], 249.998291015625], null, {
            draggable: false,
            fillColor: 'rgba(0,0,0,0)',
            strokeColor: '#FF0000',
            strokeOpacity: 0.5,
            strokeWidth: 5
        });
        myMap.geoObjects.add(placemark0);
        placemarks.push(placemark0);
        circles.push(circle0);
        circleVisible.push(false);
    

        var placemark1 = new ymaps.Placemark([60.01749826195, 30.31983106816], {
            balloonContent: 'IMEI: 866011051426039<br>Координаты: 60.01749826195, 30.31983106816<br>Радиус: 500 м<br>Сервис: Mylnikov<br><a href="https://yandex.ru/maps/?ll=30.31983106816%2C60.01749826195&z=15&l=map&pt=30.31983106816,60.01749826195,pm2dgl" target="_blank">Посмотреть на Яндекс.Картах</a><br><button onclick="toggleCircleVisibility(1)">Показать радиус</button><br><button onclick="copyCoordinates(60.01749826195, 30.31983106816)">Копировать координаты</button><br><button onclick="removeTower(1)">Удалить вышку</button>' 
        }, {
            preset: 'islands#blueIcon'
        });
        var circle1 = new ymaps.Circle([[60.01749826195, 30.31983106816], 500], null, {
            draggable: false,
            fillColor: 'rgba(0,0,0,0)',
            strokeColor: '#0000FF',
            strokeOpacity: 0.5,
            strokeWidth: 5
        });
        myMap.geoObjects.add(placemark1);
        placemarks.push(placemark1);
        circles.push(circle1);
        circleVisible.push(false);
    

        var placemark2 = new ymaps.Placemark([59.92770004272461, 30.36062812805176], {
            balloonContent: 'IMEI: 864626045075998<br>Координаты: 59.92770004272461, 30.36062812805176<br>Радиус: 398.1062927246094 м<br>Сервис: Yandex<br><a href="https://yandex.ru/maps/?ll=30.36062812805176%2C59.92770004272461&z=15&l=map&pt=30.36062812805176,59.92770004272461,pm2dgl" target="_blank">Посмотреть на Яндекс.Картах</a><br><button onclick="toggleCircleVisibility(2)">Показать радиус</button><br><button onclick="copyCoordinates(59.92770004272461, 30.36062812805176)">Копировать координаты</button><br><button onclick="removeTower(2)">Удалить вышку</button>' 
        }, {
            preset: 'islands#redIcon'
        });
        var circle2 = new ymaps.Circle([[59.92770004272461, 30.36062812805176], 398.1062927246094], null, {
            draggable: false,
            fillColor: 'rgba(0,0,0,0)',
            strokeColor: '#FF0000',
            strokeOpacity: 0.5,
            strokeWidth: 5
        });
        myMap.geoObjects.add(placemark2);
        placemarks.push(placemark2);
        circles.push(circle2);
        circleVisible.push(false);
    

        var placemark3 = new ymaps.Placemark([59.92658159479, 30.36153264871], {
            balloonContent: 'IMEI: 864626045075998<br>Координаты: 59.92658159479, 30.36153264871<br>Радиус: 500 м<br>Сервис: Mylnikov<br><a href="https://yandex.ru/maps/?ll=30.36153264871%2C59.92658159479&z=15&l=map&pt=30.36153264871,59.92658159479,pm2dgl" target="_blank">Посмотреть на Яндекс.Картах</a><br><button onclick="toggleCircleVisibility(3)">Показать радиус</button><br><button onclick="copyCoordinates(59.92658159479, 30.36153264871)">Копировать координаты</button><br><button onclick="removeTower(3)">Удалить вышку</button>' 
        }, {
            preset: 'islands#blueIcon'
        });
        var circle3 = new ymaps.Circle([[59.92658159479, 30.36153264871], 500], null, {
            draggable: false,
            fillColor: 'rgba(0,0,0,0)',
            strokeColor: '#0000FF',
            strokeOpacity: 0.5,
            strokeWidth: 5
        });
        myMap.geoObjects.add(placemark3);
        placemarks.push(placemark3);
        circles.push(circle3);
        circleVisible.push(false);
    

        var placemark4 = new ymaps.Placemark([55.74031448364258, 37.53614807128906], {
            balloonContent: 'IMEI: 866011051925451<br>Координаты: 55.74031448364258, 37.53614807128906<br>Радиус: 157.218994140625 м<br>Сервис: Yandex<br><a href="https://yandex.ru/maps/?ll=37.53614807128906%2C55.74031448364258&z=15&l=map&pt=37.53614807128906,55.74031448364258,pm2dgl" target="_blank">Посмотреть на Яндекс.Картах</a><br><button onclick="toggleCircleVisibility(4)">Показать радиус</button><br><button onclick="copyCoordinates(55.74031448364258, 37.53614807128906)">Копировать координаты</button><br><button onclick="removeTower(4)">Удалить вышку</button>' 
        }, {
            preset: 'islands#redIcon'
        });
        var circle4 = new ymaps.Circle([[55.74031448364258, 37.53614807128906], 157.218994140625], null, {
            draggable: false,
            fillColor: 'rgba(0,0,0,0)',
            strokeColor: '#FF0000',
            strokeOpacity: 0.5,
            strokeWidth: 5
        });
        myMap.geoObjects.add(placemark4);
        placemarks.push(placemark4);
        circles.push(circle4);
        circleVisible.push(false);
    

        var placemark5 = new ymaps.Placemark([55.74377131604, 37.54348776393], {
            balloonContent: 'IMEI: 866011051925451<br>Координаты: 55.74377131604, 37.54348776393<br>Радиус: 500 м<br>Сервис: Mylnikov<br><a href="https://yandex.ru/maps/?ll=37.54348776393%2C55.74377131604&z=15&l=map&pt=37.54348776393,55.74377131604,pm2dgl" target="_blank">Посмотреть на Яндекс.Картах</a><br><button onclick="toggleCircleVisibility(5)">Показать радиус</button><br><button onclick="copyCoordinates(55.74377131604, 37.54348776393)">Копировать координаты</button><br><button onclick="removeTower(5)">Удалить вышку</button>' 
        }, {
            preset: 'islands#blueIcon'
        });
        var circle5 = new ymaps.Circle([[55.74377131604, 37.54348776393], 500], null, {
            draggable: false,
            fillColor: 'rgba(0,0,0,0)',
            strokeColor: '#0000FF',
            strokeOpacity: 0.5,
            strokeWidth: 5
        });
        myMap.geoObjects.add(placemark5);
        placemarks.push(placemark5);
        circles.push(circle5);
        circleVisible.push(false);
    

        var placemark6 = new ymaps.Placemark([47.25345230102539, 39.70317459106445], {
            balloonContent: 'IMEI: 869696045874976<br>Координаты: 47.25345230102539, 39.70317459106445<br>Радиус: 1024.928955078125 м<br>Сервис: Yandex<br><a href="https://yandex.ru/maps/?ll=39.70317459106445%2C47.25345230102539&z=15&l=map&pt=39.70317459106445,47.25345230102539,pm2dgl" target="_blank">Посмотреть на Яндекс.Картах</a><br><button onclick="toggleCircleVisibility(6)">Показать радиус</button><br><button onclick="copyCoordinates(47.25345230102539, 39.70317459106445)">Копировать координаты</button><br><button onclick="removeTower(6)">Удалить вышку</button>' 
        }, {
            preset: 'islands#redIcon'
        });
        var circle6 = new ymaps.Circle([[47.25345230102539, 39.70317459106445], 1024.928955078125], null, {
            draggable: false,
            fillColor: 'rgba(0,0,0,0)',
            strokeColor: '#FF0000',
            strokeOpacity: 0.5,
            strokeWidth: 5
        });
        myMap.geoObjects.add(placemark6);
        placemarks.push(placemark6);
        circles.push(circle6);
        circleVisible.push(false);
    

        var placemark7 = new ymaps.Placemark([47.25377337562, 39.69915973494], {
            balloonContent: 'IMEI: 869696045874976<br>Координаты: 47.25377337562, 39.69915973494<br>Радиус: 500 м<br>Сервис: Mylnikov<br><a href="https://yandex.ru/maps/?ll=39.69915973494%2C47.25377337562&z=15&l=map&pt=39.69915973494,47.25377337562,pm2dgl" target="_blank">Посмотреть на Яндекс.Картах</a><br><button onclick="toggleCircleVisibility(7)">Показать радиус</button><br><button onclick="copyCoordinates(47.25377337562, 39.69915973494)">Копировать координаты</button><br><button onclick="removeTower(7)">Удалить вышку</button>' 
        }, {
            preset: 'islands#blueIcon'
        });
        var circle7 = new ymaps.Circle([[47.25377337562, 39.69915973494], 500], null, {
            draggable: false,
            fillColor: 'rgba(0,0,0,0)',
            strokeColor: '#0000FF',
            strokeOpacity: 0.5,
            strokeWidth: 5
        });
        myMap.geoObjects.add(placemark7);
        placemarks.push(placemark7);
        circles.push(circle7);
        circleVisible.push(false);
    

        var placemark8 = new ymaps.Placemark([55.79161834716797, 37.60419845581055], {
            balloonContent: 'IMEI: 866011051803278<br>Координаты: 55.79161834716797, 37.60419845581055<br>Радиус: 157.218994140625 м<br>Сервис: Yandex<br><a href="https://yandex.ru/maps/?ll=37.60419845581055%2C55.79161834716797&z=15&l=map&pt=37.60419845581055,55.79161834716797,pm2dgl" target="_blank">Посмотреть на Яндекс.Картах</a><br><button onclick="toggleCircleVisibility(8)">Показать радиус</button><br><button onclick="copyCoordinates(55.79161834716797, 37.60419845581055)">Копировать координаты</button><br><button onclick="removeTower(8)">Удалить вышку</button>' 
        }, {
            preset: 'islands#redIcon'
        });
        var circle8 = new ymaps.Circle([[55.79161834716797, 37.60419845581055], 157.218994140625], null, {
            draggable: false,
            fillColor: 'rgba(0,0,0,0)',
            strokeColor: '#FF0000',
            strokeOpacity: 0.5,
            strokeWidth: 5
        });
        myMap.geoObjects.add(placemark8);
        placemarks.push(placemark8);
        circles.push(circle8);
        circleVisible.push(false);
    

        var placemark9 = new ymaps.Placemark([55.7905663226, 37.60269722611], {
            balloonContent: 'IMEI: 866011051803278<br>Координаты: 55.7905663226, 37.60269722611<br>Радиус: 500 м<br>Сервис: Mylnikov<br><a href="https://yandex.ru/maps/?ll=37.60269722611%2C55.7905663226&z=15&l=map&pt=37.60269722611,55.7905663226,pm2dgl" target="_blank">Посмотреть на Яндекс.Картах</a><br><button onclick="toggleCircleVisibility(9)">Показать радиус</button><br><button onclick="copyCoordinates(55.7905663226, 37.60269722611)">Копировать координаты</button><br><button onclick="removeTower(9)">Удалить вышку</button>' 
        }, {
            preset: 'islands#blueIcon'
        });
        var circle9 = new ymaps.Circle([[55.7905663226, 37.60269722611], 500], null, {
            draggable: false,
            fillColor: 'rgba(0,0,0,0)',
            strokeColor: '#0000FF',
            strokeOpacity: 0.5,
            strokeWidth: 5
        });
        myMap.geoObjects.add(placemark9);
        placemarks.push(placemark9);
        circles.push(circle9);
        circleVisible.push(false);
    

        var placemark10 = new ymaps.Placemark([55.73954391479492, 37.60413360595703], {
            balloonContent: 'IMEI: 866011051443109<br>Координаты: 55.73954391479492, 37.60413360595703<br>Радиус: 157.218994140625 м<br>Сервис: Yandex<br><a href="https://yandex.ru/maps/?ll=37.60413360595703%2C55.73954391479492&z=15&l=map&pt=37.60413360595703,55.73954391479492,pm2dgl" target="_blank">Посмотреть на Яндекс.Картах</a><br><button onclick="toggleCircleVisibility(10)">Показать радиус</button><br><button onclick="copyCoordinates(55.73954391479492, 37.60413360595703)">Копировать координаты</button><br><button onclick="removeTower(10)">Удалить вышку</button>' 
        }, {
            preset: 'islands#redIcon'
        });
        var circle10 = new ymaps.Circle([[55.73954391479492, 37.60413360595703], 157.218994140625], null, {
            draggable: false,
            fillColor: 'rgba(0,0,0,0)',
            strokeColor: '#FF0000',
            strokeOpacity: 0.5,
            strokeWidth: 5
        });
        myMap.geoObjects.add(placemark10);
        placemarks.push(placemark10);
        circles.push(circle10);
        circleVisible.push(false);
    

        var placemark11 = new ymaps.Placemark([55.74162335573, 37.60329974919], {
            balloonContent: 'IMEI: 866011051443109<br>Координаты: 55.74162335573, 37.60329974919<br>Радиус: 500 м<br>Сервис: Mylnikov<br><a href="https://yandex.ru/maps/?ll=37.60329974919%2C55.74162335573&z=15&l=map&pt=37.60329974919,55.74162335573,pm2dgl" target="_blank">Посмотреть на Яндекс.Картах</a><br><button onclick="toggleCircleVisibility(11)">Показать радиус</button><br><button onclick="copyCoordinates(55.74162335573, 37.60329974919)">Копировать координаты</button><br><button onclick="removeTower(11)">Удалить вышку</button>' 
        }, {
            preset: 'islands#blueIcon'
        });
        var circle11 = new ymaps.Circle([[55.74162335573, 37.60329974919], 500], null, {
            draggable: false,
            fillColor: 'rgba(0,0,0,0)',
            strokeColor: '#0000FF',
            strokeOpacity: 0.5,
            strokeWidth: 5
        });
        myMap.geoObjects.add(placemark11);
        placemarks.push(placemark11);
        circles.push(circle11);
        circleVisible.push(false);
    
                    var bounds = myMap.geoObjects.getBounds();
                    if (bounds) {
                        myMap.setBounds(bounds, { checkZoomRange: true, zoomMargin: 50 }).then(function() {
                            if (myMap.getZoom() > 10) {
                                myMap.setZoom(10);
                            }
                        });
                    }
                }

                function toggleService(service) {
                    if (service === 'Yandex') {
                        yandexVisible = !yandexVisible;
                        for (var i = 0; i < placemarks.length; i++) {
                            if (placemarks[i].options.get('preset') === 'islands#redIcon') {
                                if (yandexVisible) {
                                    myMap.geoObjects.add(placemarks[i]);
                                    if (circleVisible[i]) {
                                        myMap.geoObjects.add(circles[i]);
                                    }
                                } else {
                                    myMap.geoObjects.remove(placemarks[i]);
                                    myMap.geoObjects.remove(circles[i]);
                                }
                            }
                        }
                    } else if (service === 'Mylnikov') {
                        mylnikovVisible = !mylnikovVisible;
                        for (var i = 0; i < placemarks.length; i++) {
                            if (placemarks[i].options.get('preset') === 'islands#blueIcon') {
                                if (mylnikovVisible) {
                                    myMap.geoObjects.add(placemarks[i]);
                                    if (circleVisible[i]) {
                                        myMap.geoObjects.add(circles[i]);
                                    }
                                } else {
                                    myMap.geoObjects.remove(placemarks[i]);
                                    myMap.geoObjects.remove(circles[i]);
                                }
                            }
                        }
                    }
                }

                function searchByIMEI() {
                    var imeiInput = document.getElementById('imeiSearch').value;
                    for (var i = 0; i < placemarks.length; i++) {
                        var balloonContent = placemarks[i].properties.get('balloonContent');
                        if (balloonContent.includes('IMEI: ' + imeiInput)) {
                            placemarks[i].options.set('preset', 'islands#yellowIcon');
                            myMap.setCenter(placemarks[i].geometry.getCoordinates(), 15);
                        } else {
                            placemarks[i].options.set('preset', placemarks[i].options.get('preset').includes('red') ? 'islands#redIcon' : 'islands#blueIcon');
                        }
                    }
                }

                function toggleCircleVisibility(index) {
                    if (circleVisible[index]) {
                        myMap.geoObjects.remove(circles[index]);
                        placemarks[index].properties.set('balloonContent', placemarks[index].properties.get('balloonContent').replace('Скрыть радиус', 'Показать радиус'));
                    } else {
                        myMap.geoObjects.add(circles[index]);
                        placemarks[index].properties.set('balloonContent', placemarks[index].properties.get('balloonContent').replace('Показать радиус', 'Скрыть радиус'));
                    }
                    circleVisible[index] = !circleVisible[index];
                }

                function copyCoordinates(lat, lon) {
                    var coordinates = lat.toFixed(6) + ', ' + lon.toFixed(6);
                    navigator.clipboard.writeText(coordinates).then(function() {
                        alert("Координаты скопированы: " + coordinates);
                    });
                }

                function removeTower(index) {
                    myMap.geoObjects.remove(placemarks[index]);
                    myMap.geoObjects.remove(circles[index]);
                    placemarks.splice(index, 1);
                    circles.splice(index, 1);
                    circleVisible.splice(index, 1);
                    
                    // Обновление CSV-файла
                    updateCSVFile();
                }

                function updateCSVFile() {
                    var newData = [];
                    for (var i = 0; i < placemarks.length; i++) {
                        var balloonContent = placemarks[i].properties.get('balloonContent');
                        var imeiMatch = balloonContent.match(/IMEI: (\w+)/);
                        if (imeiMatch) {
                            newData.push({
                                'IMEI': imeiMatch[1],
                                'MCC': '250',
                                'MNC': 'unknown',
                                'LAC': 'unknown',
                                'CELLID': 'unknown'
                            });
                        }
                    }
                    
                    // Создание временного файла CSV для скачивания
                    var csvContent = "IMEI,MCC,MNC,LAC,CELLID\n";
                    newData.forEach(function(row) {
                        csvContent += row.IMEI + "," + row.MCC + "," + row.MNC + "," + row.LAC + "," + row.CELLID + "\n";
                    });
                    var blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
                    var link = document.createElement("a");
                    link.href = URL.createObjectURL(blob);
                    link.download = "updated_towers.csv";
                    link.click();
                }
            </script>
        </body>
        </html>
    